{% extends 'base.html' %}
{% load static %}

{% block title %}{% if form.instance.pk %}Edit{% else %}Add{% endif %} Event{% endblock %}
{% block content %}
<div class="max-w-3xl mx-auto mt-6">
  <h2 class="text-xl font-semibold mb-4">{% if form.instance.pk %}Edit{% else %}Add{% endif %} Event</h2>
  <form method="post" enctype="multipart/form-data" style="margin-top: 20px;">
    {% csrf_token %}
    {{ form.as_p }}
    <div class="mb-4">
      <label for="id_media" class="block text-sm font-medium text-gray-700">Upload Media (Optional)</label>
      <input type="file" name="media" id="id_media" accept=".jpg,.png,.pdf,.mp3,.wav" class="mt-1 block w-full">
      <p class="text-sm text-gray-500">Max 50MB. Allowed: .jpg, .png, .pdf, .mp3, .wav</p>
      <div id="media-preview" class="mt-2"></div>
      {% if form.instance.pk and form.instance.media_url %}
        <p class="text-gray-600 mt-2">Current Media:</p>
        {% if form.instance.media_type and form.instance.media_type|slice:":5" == "image" %}
          <img src="{{ form.instance.media_url }}" alt="Event Image" class="max-w-xs rounded-lg shadow-md">
        {% elif form.instance.media_type and form.instance.media_type|slice:":5" == "audio" %}
          <audio controls>
            <source src="{{ form.instance.media_url }}" type="{{ form.instance.media_type }}">
            Your browser does not support the audio element.
          </audio>
        {% elif form.instance.media_type == "application/pdf" %}
          <embed src="{{ form.instance.media_url }}" type="application/pdf" class="w-full h-64 rounded shadow" />
        {% endif %}
        <label class="mt-2 block">
          <input type="checkbox" name="remove_media" class="mr-2"> Remove Media
        </label>
      {% endif %}
    </div>
    <div class="flex gap-4">
      <button type="submit" class="btn glow bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition shadow-md">
        {% if form.instance.pk %}Update{% else %}Add{% endif %}
      </button>
      <a href="{% url 'event_list' %}" class="btn btn-secondary glow bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition shadow-md">Cancel</a>
    </div>
  </form>
</div>
<script src="{% static 'js/event_form.js' %}"></script>
{% endblock %}